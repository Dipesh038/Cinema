<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ¬ Cinemax Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Audiowide&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8e44ad; /* purple */
            --primary-dark: #6d2f8d;
            --accent: #ffca28; /* gold */
            --hover: #a464c6;
            --success: #10b981;
            --danger: #ff3d00;
            --warning: #ffa500;
            --bg-main: #0d0d0d;
            --bg-sidebar: #1b1b1b;
            --bg-card: #1e1e1e;
            --bg-input: #242424;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-light: #ffffff;
            --border: #2a2a2a;
            --shadow: rgba(0, 0, 0, 0.3);
            --shadow-hover: rgba(142, 68, 173, 0.35);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
        }

        /* Typography */
        h1, h2, h3, .page-title, .card-title {
            font-family: 'Audiowide', cursive;
            letter-spacing: 0.5px;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: 4px 0 15px rgba(0, 0, 0, 0.2);
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, #1c1c1c 0%, #2a2a2a 100%);
        }

        .cinema-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .cinema-logo i { display: none; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .cinema-logo h1 {
            font-family: 'Audiowide', cursive;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(90deg, #ffca28, #f06292);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
            text-shadow: 0 0 30px rgba(255, 202, 40, 0.25);
        }

        .cinema-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-left: 3rem;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1.5rem 0;
            overflow-y: auto;
        }

        .nav-item {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255, 61, 0, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
            padding-left: 1.75rem;
        }

        .nav-item.active {
            background: rgba(255, 61, 0, 0.15);
            color: var(--primary);
            border-left-color: var(--primary);
            font-weight: 600;
        }

        .nav-item i {
            width: 24px;
            font-size: 1.25rem;
            text-align: center;
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .back-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem;
            background: rgba(255, 61, 0, 0.1);
            border: 1px solid rgba(255, 61, 0, 0.3);
            border-radius: 12px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: var(--primary);
            color: white;
            transform: translateX(-4px);
            box-shadow: 0 4px 15px rgba(255, 61, 0, 0.3);
        }

        /* Mobile Toggle */
        .sidebar-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.25rem;
            box-shadow: 0 4px 15px var(--shadow-hover);
            transition: all 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: var(--hover);
            transform: scale(1.05);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex: 1;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        /* Topbar */
        .topbar {
            background: #151515;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .topbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .page-title i { color: var(--accent); }

        .topbar-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .quick-action-btn {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 4px 10px var(--shadow-hover);
        }

        .quick-action-btn:hover {
            background: var(--hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        /* Container */
        .container {
            padding: 2rem;
            max-width: 1400px;
        }

        /* Section */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Dashboard Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            padding: 1.75rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px var(--shadow);
            display: flex;
            align-items: center;
            gap: 1.25rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px var(--shadow-hover); border-color: var(--accent); }

        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            flex-shrink: 0;
        }

        .stat-icon.orange { background: rgba(255, 61, 0, 0.1); color: var(--primary); }
        .stat-icon.green { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .stat-icon.blue { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .stat-icon.purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }

        .stat-details {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-change {
            font-size: 0.75rem;
            color: var(--success);
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 10px var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--bg-main);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--text-primary);
        }

        .card-title i {
            color: var(--primary);
            font-size: 1.75rem;
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group label i {
            color: var(--primary);
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.875rem 1rem;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-input);
            color: var(--text-primary);
            box-shadow: 0 0 0 3px rgba(255, 61, 0, 0.1);
        }

        /* Improve text visibility and caret/placeholder in inputs */
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            caret-color: var(--accent);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px var(--shadow-hover);
        }

        .btn-primary:hover {
            background: var(--hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .btn-primary:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-accent {
            background: var(--accent);
            color: #000;
            box-shadow: 0 4px 10px var(--shadow-hover);
        }

        .btn-accent:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-hover);
        }

        .btn-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .btn-info:hover {
            background: linear-gradient(135deg, #5568d3 0%, #6a3f8f 100%);
            transform: translateY(-2px);
        }

        .btn-success:hover {
            background: #0d9668;
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Movies Grid */
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .movie-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px var(--shadow);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .movie-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px var(--shadow-hover); border-color: var(--accent); }

        .movie-poster { width: 100%; height: 220px; object-fit: cover; background: var(--bg-input); display: block; }

        .movie-content {
            padding: 1.5rem;
        }

        .movie-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .movie-title i {
            color: var(--primary);
        }

        .movie-info {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .movie-info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .movie-info-item i {
            width: 18px;
            color: var(--primary);
        }

        .movie-info-item strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .movie-actions {
            display: flex;
            gap: 0.5rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .movie-actions .btn {
            flex: 1 1 auto;
            min-width: 80px;
            font-size: 0.8rem;
            padding: 0.6rem 0.8rem;
            white-space: nowrap;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: transparent;
            color: var(--text-primary);
        }

        thead {
            background: #222;
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:hover {
            background: rgba(142, 68, 173, 0.08);
        }

        /* Alerts */
        .alert {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert i {
            font-size: 1.25rem;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .alert-error {
            background: rgba(255, 61, 0, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .loading i {
            animation: spin 1s linear infinite;
            font-size: 2rem;
            color: var(--primary);
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 1.125rem;
            font-weight: 500;
        }

        /* Search Bar */
        .search-bar {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-bar input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 3rem;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s ease;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-input);
            color: var(--text-primary);
            box-shadow: 0 0 0 3px rgba(255, 61, 0, 0.1);
        }

        .search-bar i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 968px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-toggle {
                display: block;
            }

            .main-content {
                margin-left: 0;
            }

            .topbar {
                padding: 1rem;
            }

            .page-title {
                font-size: 1.5rem;
            }

            .topbar-actions {
                width: 100%;
                justify-content: stretch;
            }

            .quick-action-btn {
                flex: 1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .movies-grid {
                grid-template-columns: 1fr;
            }

            .movie-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(255, 165, 0, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(255, 61, 0, 0.1);
            color: var(--danger);
        }

        /* Price Management Section */
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- Mobile Toggle -->
    <button class="sidebar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="cinema-logo">
                <h1>Cinemax Admin</h1>
            </div>
            <div class="cinema-subtitle">Management Panel</div>
        </div>

        <nav class="sidebar-nav">
            <a class="nav-item active" onclick="showSection('dashboard')" data-section="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a class="nav-item" onclick="showSection('movies')" data-section="movies">
                <i class="fas fa-video"></i>
                <span>Movies</span>
            </a>
            <a class="nav-item" href="/admin-seats.html">
                <i class="fas fa-chair"></i>
                <span>Seat Management</span>
            </a>
            <a class="nav-item" onclick="showSection('shows')" data-section="shows">
                <i class="fas fa-clock"></i>
                <span>Shows</span>
            </a>
            <a class="nav-item" onclick="showSection('users')" data-section="users">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </a>
            <a class="nav-item" onclick="showSection('notifications')" data-section="notifications">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
            </a>
            <a class="nav-item" onclick="showSection('bookings')" data-section="bookings">
                <i class="fas fa-ticket-alt"></i>
                <span>Bookings</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="/" class="back-link">
                <i class="fas fa-arrow-left"></i> Back to Frontend
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Topbar -->
        <div class="topbar">
            <div class="topbar-content">
                <h1 class="page-title">
                    <i class="fas fa-chart-line"></i>
                    <span id="pageTitle">Dashboard</span>
                </h1>
                <div class="topbar-actions">
                    <button class="quick-action-btn" onclick="showSection('movies')">
                        <i class="fas fa-plus-circle"></i>
                        Add Movie
                    </button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-video"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalMovies">0</div>
                            <div class="stat-label">Total Movies</div>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> Active
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="totalBookings">0</div>
                            <div class="stat-label">Total Bookings</div>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> All Time
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value" id="activeShows">0</div>
                            <div class="stat-label">Active Shows</div>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> Today
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-rupee-sign"></i>
                        </div>
                        <div class="stat-details">
                            <div class="stat-value">â‚¹<span id="totalRevenue">0</span></div>
                            <div class="stat-label">Total Revenue</div>
                            <div class="stat-change">
                                <i class="fas fa-arrow-up"></i> This Month
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Quick Overview
                        </h2>
                    </div>
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Detailed analytics and charts coming soon...</p>
                    </div>
                </div>
            </div>

            <!-- Movies Section -->
            <div id="movies" class="section">
                <!-- Add Movie Card -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" id="movieFormTitle">
                            <i class="fas fa-plus-circle"></i>
                            Add New Movie
                        </h2>
                    </div>
                    <form id="addMovieForm">
                        <input type="hidden" id="editMovieId" name="editMovieId" value="">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="title">
                                    <i class="fas fa-heading"></i>
                                    Movie Title *
                                </label>
                                <input type="text" id="title" name="title" placeholder="Enter movie title" required>
                            </div>

                            <div class="form-group">
                                <label for="language">
                                    <i class="fas fa-language"></i>
                                    Languages (select one or more) *
                                </label>
                                <select id="language" name="language" multiple size="6">
                                    <option value="English">English</option>
                                    <option value="Hindi">Hindi</option>
                                    <option value="Tamil">Tamil</option>
                                    <option value="Telugu">Telugu</option>
                                    <option value="Malayalam">Malayalam</option>
                                    <option value="Kannada">Kannada</option>
                                    <option value="Bengali">Bengali</option>
                                    <option value="Marathi">Marathi</option>
                                    <option value="Gujarati">Gujarati</option>
                                </select>
                                <small style="color: var(--text-secondary);">Tip: Hold Cmd (Mac) or Ctrl (Windows) to multi-select.</small>
                            </div>

                            <div class="form-group">
                                <label for="format">
                                    <i class="fas fa-film"></i>
                                    Formats (select one or more) *
                                </label>
                                <select id="format" name="format" multiple size="5">
                                    <option value="2D">2D</option>
                                    <option value="3D">3D</option>
                                    <option value="IMAX">IMAX</option>
                                    <option value="4DX">4DX</option>
                                    <option value="Dolby">Dolby Atmos</option>
                                </select>
                                <small style="color: var(--text-secondary);">Tip: Hold Cmd (Mac) or Ctrl (Windows) to multi-select.</small>
                            </div>

                            <div class="form-group">
                                <label for="price">
                                    <i class="fas fa-rupee-sign"></i>
                                    Base Ticket Price (â‚¹) *
                                </label>
                                <input type="number" id="price" name="price" step="0.01" min="0" placeholder="0.00" required>
                            </div>

                            <div class="form-group">
                                <label for="classicSeatPrice">
                                    <i class="fas fa-chair"></i>
                                    Classic Seat Price (â‚¹) *
                                </label>
                                <input type="number" id="classicSeatPrice" name="classicSeatPrice" step="0.01" min="0" placeholder="381.36" value="381.36" required>
                            </div>

                            <div class="form-group">
                                <label for="primeSeatPrice">
                                    <i class="fas fa-crown"></i>
                                    Prime Seat Price (â‚¹) *
                                </label>
                                <input type="number" id="primeSeatPrice" name="primeSeatPrice" step="0.01" min="0" placeholder="481.36" value="481.36" required>
                            </div>

                            <div class="form-group">
                                <label for="date">
                                    <i class="fas fa-calendar"></i>
                                    Show Date *
                                </label>
                                <input type="date" id="date" name="date" required>
                            </div>

                            <div class="form-group">
                                <label for="showtime">
                                    <i class="fas fa-clock"></i>
                                    Show Time *
                                </label>
                                <input type="time" id="showtime" name="showtime" required value="19:00">
                            </div>

                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="description">
                                    <i class="fas fa-align-left"></i>
                                    Description
                                </label>
                                <textarea id="description" name="description" placeholder="Enter movie description (optional)"></textarea>
                            </div>

                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="picture">
                                    <i class="fas fa-image"></i>
                                    Movie Poster URL
                                </label>
                                <input type="url" id="picture" name="picture" placeholder="https://example.com/poster.jpg">
                            </div>
                        </div>

                                            <div style="display: flex; gap: 1rem;">
                                                <button type="submit" class="btn btn-primary" id="movieSubmitBtn">
                                                    <i class="fas fa-plus" id="movieSubmitIcon"></i>
                                                    <span id="movieSubmitBtnText">Add Movie</span>
                                                </button>
                                                <button type="button" class="btn btn-secondary" onclick="resetMovieForm()">
                                                    <i class="fas fa-times"></i>
                                                    Cancel
                                                </button>
                                            </div>
                    </form>
                </div>

                <!-- Movies List Card -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-list"></i>
                            All Movies
                        </h2>
                    </div>
                    
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="movieSearch" placeholder="Search movies by title..." onkeyup="filterMovies()">
                    </div>

                    <div class="movies-grid" id="moviesContainer">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Loading movies...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shows Section -->
            <div id="shows" class="section">
                <!-- All Shows -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-list"></i> All Shows</h2>
                        <div>
                            <button class="btn btn-secondary btn-small" onclick="loadAllShows()"><i class="fas fa-sync"></i> Refresh</button>
                        </div>
                    </div>
                    <div class="table-container" id="allShowsContainer">
                        <div class="loading"><i class="fas fa-spinner"></i><p>Loading all shows...</p></div>
                    </div>
                </div>
            </div>

            <!-- Bookings Section -->
            <div id="bookings" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-ticket-alt"></i>
                            All Bookings
                        </h2>
                    </div>
                    
                    <div class="table-container" id="bookingsContainer">
                        <div class="loading">
                            <i class="fas fa-spinner"></i>
                            <p>Loading bookings...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-users"></i> Users</h2>
                        <div>
                            <button class="btn btn-secondary btn-small" onclick="syncUsers()"><i class="fas fa-sync"></i> Sync from Bookings</button>
                        </div>
                    </div>
                    <div class="table-container" id="usersContainer">
                        <div class="loading"><i class="fas fa-spinner"></i><p>Loading users...</p></div>
                    </div>
                </div>
            </div>

            <!-- Notifications Section -->
            <div id="notifications" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-bell"></i> Send Notification</h2>
                    </div>
                    <form id="notifyForm">
                        <div class="form-grid">
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <label for="notifyMessage"><i class="fas fa-comment"></i> Message</label>
                                <textarea id="notifyMessage" placeholder="Type your message..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="notifyUsers"><i class="fas fa-user-check"></i> Send To</label>
                                <select id="notifyUsers">
                                    <option value="all">All users</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-accent"><i class="fas fa-paper-plane"></i> Send</button>
                    </form>
                    <div class="card" style="margin-top:1rem;">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fas fa-inbox"></i> Recent Notifications</h2>
                        </div>
                        <div class="table-container" id="notificationsContainer">
                            <div class="loading"><i class="fas fa-spinner"></i><p>Loading notifications...</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pricing Section -->
            <div id="pricing" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-money-bill-wave"></i>
                            Global Seat Price Management
                        </h2>
                    </div>
                    <form id="priceFormGlobal" style="padding: 1rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem;">
                        <div class="form-group">
                            <label for="globalClassicPrice"><i class="fas fa-chair"></i> Classic Seat Price (â‚¹)</label>
                            <input type="number" id="globalClassicPrice" min="0" step="0.01" placeholder="381.36" required>
                        </div>
                        <div class="form-group">
                            <label for="globalPrimePrice"><i class="fas fa-crown"></i> Prime Seat Price (â‚¹)</label>
                            <input type="number" id="globalPrimePrice" min="0" step="0.01" placeholder="481.36" required>
                        </div>
                        <div style="display:flex; gap: .75rem; align-items: end;">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Update Prices</button>
                            <button type="button" class="btn btn-secondary" id="loadSamplePrices"><i class="fas fa-sync"></i> Load Sample</button>
                        </div>
                    </form>
                    <div class="alert alert-info" style="margin: 0 1rem 1rem;">
                        <i class="fas fa-info-circle"></i>
                        Updating here will apply Classic/Prime prices to all active movies instantly.
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const API_URL = 'http://localhost:3000/api';

        // Sidebar toggle for mobile
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Section navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                movies: 'Movies Management',
                shows: 'Shows Management',
                users: 'Users',
                notifications: 'Notifications',
                bookings: 'Bookings',
                pricing: 'Pricing'
            };
            document.getElementById('pageTitle').textContent = titles[sectionId];

            // Close sidebar on mobile after selection
            if (window.innerWidth <= 968) {
                document.getElementById('sidebar').classList.remove('open');
            }

            // Load data based on section
            if (sectionId === 'movies') {
                loadMovies();
            } else if (sectionId === 'bookings') {
                loadBookings();
            } else if (sectionId === 'dashboard') {
                loadDashboardStats();
            } else if (sectionId === 'users') {
                loadUsers();
            } else if (sectionId === 'notifications') {
                loadNotifications();
                populateNotifyUsers();
            } else if (sectionId === 'shows') {
                initShowsSection();
            }
        }

        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                const res = await fetch(`${API_URL}/stats`);
                const stats = await res.json();
                document.getElementById('totalMovies').textContent = stats.movies ?? 0;
                document.getElementById('totalBookings').textContent = stats.bookings ?? 0;
                document.getElementById('activeShows').textContent = stats.movies ?? 0;
                document.getElementById('totalRevenue').textContent = (stats.revenue ?? 0).toFixed(2);
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // DOM Elements
        const addMovieForm = document.getElementById('addMovieForm');
        const moviesContainer = document.getElementById('moviesContainer');

        // Load movies on page load and when movies section is active
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboardStats();
            // Wire global pricing form if present
            const priceFormGlobal = document.getElementById('priceFormGlobal');
            if (priceFormGlobal) {
                priceFormGlobal.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const cp = parseFloat(document.getElementById('globalClassicPrice').value);
                    const pp = parseFloat(document.getElementById('globalPrimePrice').value);
                    if (!isFinite(cp) || !isFinite(pp) || cp < 0 || pp < 0) {
                        showAlert('Please enter valid non-negative prices', 'error');
                        return;
                    }
                    try {
                        const res = await fetch(`${API_URL}/movies/prices`, {
                            method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ classic_price: cp, prime_price: pp })
                        });
                        const data = await res.json();
                        if (!res.ok) throw new Error(data.error || 'Update failed');
                        showAlert(`Prices updated for ${data.updated} movies`, 'success');
                        // Optionally refresh movies grid
                        loadMovies();
                    } catch (err) {
                        showAlert('Failed to update prices: ' + err.message, 'error');
                    }
                });
                const loadSampleBtn = document.getElementById('loadSamplePrices');
                if (loadSampleBtn) loadSampleBtn.addEventListener('click', () => {
                    document.getElementById('globalClassicPrice').value = '381.36';
                    document.getElementById('globalPrimePrice').value = '481.36';
                });
            }
        });

        // ===== Screens & Shows Management =====
        async function initShowsSection() {
            await loadAllShows().catch(()=>{});
        }

        async function loadAllShows() {
            const container = document.getElementById('allShowsContainer');
            try {
                const res = await fetch(`${API_URL}/shows`);
                const shows = await res.json();
                if (!Array.isArray(shows) || shows.length === 0) {
                    container.innerHTML = `<div class='empty-state'><i class='fas fa-list'></i><p>No shows found.</p></div>`;
                    return;
                }
                container.innerHTML = `
                    <table>
                        <thead><tr><th>ID</th><th>Movie</th><th>Date</th><th>Time</th><th>Format</th><th>Screen</th><th>Actions</th></tr></thead>
                        <tbody>
                        ${shows.map(s => `
                            <tr>
                                <td>#${s.id}</td>
                                <td>${s.movie_title}</td>
                                <td>${s.show_date}</td>
                                <td>${s.show_time}</td>
                                <td>${s.format}</td>
                                <td>${s.screen_name} (${s.row_count || s.rows}x${s.col_count || s.cols})</td>
                                <td style="display:flex; gap:.5rem;">
                                    <button class='btn btn-secondary btn-small' onclick='openShowSeats(${s.id})'><i class="fas fa-chair"></i> Seats</button>
                                    <button class='btn btn-danger btn-small' onclick='deleteShow(${s.id})'><i class="fas fa-trash"></i> Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                        </tbody>
                    </table>`;
            } catch (e) {
                container.innerHTML = `<div class='alert alert-error'><i class='fas fa-exclamation-circle'></i> ${e.message}</div>`;
            }
        }

        async function loadScreens() {
            const container = document.getElementById('screensContainer');
            try {
                const res = await fetch(`${API_URL}/screens`);
                const screens = await res.json();
                // populate screen select too
                const sel = document.getElementById('screenSelect');
                if (sel) sel.innerHTML = (Array.isArray(screens) ? screens.map(s => `<option value="${s.id}">${s.name} (${s.row_count || s.rows}x${s.col_count || s.cols})</option>`).join('') : '');
                if (!Array.isArray(screens) || screens.length === 0) {
                    container.innerHTML = `<div class='empty-state'><i class='fas fa-tv'></i><p>No screens yet. Add one above.</p></div>`;
                    return;
                }
                container.innerHTML = `
                    <table>
                        <thead><tr><th>ID</th><th>Name</th><th>Rows</th><th>Cols</th><th>Actions</th></tr></thead>
                        <tbody>
                        ${screens.map(s => `
                            <tr>
                                <td>#${s.id}</td>
                                <td>${s.name}</td>
                                <td>${s.row_count || s.rows}</td>
                                <td>${s.col_count || s.cols}</td>
                                <td><button class='btn btn-danger btn-small' onclick='deleteScreen(${s.id})'><i class="fas fa-trash"></i> Delete</button></td>
                            </tr>
                        `).join('')}
                        </tbody>
                    </table>`;
            } catch (e) {
                container.innerHTML = `<div class='alert alert-error'><i class='fas fa-exclamation-circle'></i> ${e.message}</div>`;
            }
        }

        const addScreenForm = document.getElementById('addScreenForm');
        if (addScreenForm) {
            addScreenForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('screenName').value.trim();
                const rows = parseInt(document.getElementById('screenRows').value, 10);
                const cols = parseInt(document.getElementById('screenCols').value, 10);
                if (!name || rows < 1 || cols < 1) { showAlert('Provide valid screen details', 'error'); return; }
                try {
                    const res = await fetch(`${API_URL}/screens`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ name, rows, cols }) });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.error || 'Failed');
                    showAlert('Screen added', 'success');
                    addScreenForm.reset();
                    await loadScreens();
                } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
            });
        }

        async function deleteScreen(id) {
            if (!confirm('Delete this screen?')) return;
            try {
                const res = await fetch(`${API_URL}/screens/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                showAlert('Screen deleted', 'success');
                await loadScreens();
            } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
        }

        async function populateShowsMovieSelect() {
            const sel = document.getElementById('showsMovieSelect');
            if (!sel) return;
            try {
                const res = await fetch(`${API_URL}/movies?all=1`);
                const movies = await res.json();
                sel.innerHTML = '<option value="">Select a movie</option>' + (Array.isArray(movies) ? movies.map(m => `<option value='${m.id}'>${m.title}</option>`).join('') : '');
                sel.onchange = () => reloadShows();
            } catch {}
        }

        async function reloadShows() {
            const sel = document.getElementById('showsMovieSelect');
            if (!sel) return;
            if (!sel.value) {
                // Try to auto-select the first real movie option
                const first = Array.from(sel.options).find(o => o.value);
                if (first) sel.value = first.value; else {
                    const container = document.getElementById('showsContainer');
                    container.innerHTML = `<div class='empty-state'><i class='fas fa-video'></i><p>No movies available. Add a movie first.</p></div>`;
                    return;
                }
            }
            const container = document.getElementById('showsContainer');
            container.innerHTML = `<div class='loading'><i class='fas fa-spinner'></i><p>Loading shows...</p></div>`;
            try {
                const res = await fetch(`${API_URL}/movies/${sel.value}/shows`);
                const shows = await res.json();
                if (!Array.isArray(shows) || shows.length === 0) {
                    container.innerHTML = `<div class='empty-state'><i class='fas fa-clock'></i><p>No shows for this movie yet. Add one above.</p></div>`;
                    return;
                }
                container.innerHTML = `
                    <table>
                        <thead><tr><th>ID</th><th>Date</th><th>Time</th><th>Format</th><th>Screen</th><th>Seats</th><th>Actions</th></tr></thead>
                        <tbody>
                        ${shows.map(s => `
                            <tr>
                                <td>#${s.id}</td>
                                <td>${s.show_date}</td>
                                <td>${s.show_time}</td>
                                <td>${s.format}</td>
                                <td>${s.screen_name} (${s.row_count || s.rows}x${s.col_count || s.cols})</td>
                                <td><button class='btn btn-secondary btn-small' onclick='openShowSeats(${s.id})'><i class="fas fa-chair"></i> Manage Seats</button></td>
                                <td><button class='btn btn-danger btn-small' onclick='deleteShow(${s.id})'><i class="fas fa-trash"></i> Delete</button></td>
                            </tr>
                        `).join('')}
                        </tbody>
                    </table>`;
            } catch (e) {
                container.innerHTML = `<div class='alert alert-error'><i class='fas fa-exclamation-circle'></i> ${e.message}</div>`;
            }
        }

        async function addShow() {
            const movieSel = document.getElementById('showsMovieSelect');
            const screenSel = document.getElementById('screenSelect');
            const show_date = (document.getElementById('showDate').value || '').trim();
            const show_time = (document.getElementById('showTime').value || '').trim();
            const format = (document.getElementById('showFormat').value || '2D');
            if (!movieSel.value || !screenSel.value || !show_date || !show_time) { showAlert('Please complete show details', 'error'); return; }
            try {
                const res = await fetch(`${API_URL}/movies/${movieSel.value}/shows`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ screen_id: parseInt(screenSel.value,10), show_date, show_time, format }) });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed to add show');
                showAlert('Show added and seats generated', 'success');
                await reloadShows();
            } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
        }

        async function deleteShow(id) {
            if (!confirm('Delete this show?')) return;
            try {
                const res = await fetch(`${API_URL}/shows/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                showAlert('Show deleted', 'success');
                await reloadShows();
            } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
        }

        function openShowSeats(showId) {
            window.location.href = `/admin-seats.html?showId=${showId}`;
        }

        // Add movie form handler
        addMovieForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
                const editMovieId = document.getElementById('editMovieId').value;
                const isEditMode = editMovieId !== '';
            
            const formData = new FormData(addMovieForm);

            // Collect multi-select values
            const languageSel = document.getElementById('language');
            const formatSel = document.getElementById('format');
            const languages = Array.from(languageSel.selectedOptions).map(o => o.value).filter(Boolean);
            const formats = Array.from(formatSel.selectedOptions).map(o => o.value).filter(Boolean);

            if (!languages.length) { showAlert('Please select at least one language', 'error'); return; }
            if (!formats.length) { showAlert('Please select at least one format', 'error'); return; }

            const movieData = {
                title: formData.get('title'),
                show_date: formData.get('date'),
                show_time: formData.get('showtime'),
                // Store as comma-separated strings for backend compatibility
                language: languages.join(','),
                format: formats.join(','),
                price: parseFloat(formData.get('price')),
                classic_price: parseFloat(formData.get('classicSeatPrice')),
                prime_price: parseFloat(formData.get('primeSeatPrice')),
                picture: formData.get('picture') || 'https://via.placeholder.com/300x400',
                description: formData.get('description') || ''
            };

            try {
                    const submitBtn = document.getElementById('movieSubmitBtn');
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${isEditMode ? 'Updating...' : 'Adding...'}`;

                    const url = isEditMode ? `${API_URL}/movies/${editMovieId}` : `${API_URL}/movies`;
                    const method = isEditMode ? 'PUT' : 'POST';
                
                    const response = await fetch(url, {
                        method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(movieData)
                });

                const result = await response.json();

                if (response.ok) {
                        showAlert(isEditMode ? 'Movie updated successfully!' : 'Movie added successfully!', 'success');
                        resetMovieForm();
                    loadMovies(); // Reload movies list
                    loadDashboardStats(); // Update stats
                } else {
                    showAlert(`Error: ${result.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            } finally {
                    const submitBtn = document.getElementById('movieSubmitBtn');
                    submitBtn.disabled = false;
                    if (isEditMode) {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> <span id="movieSubmitBtnText">Update Movie</span>';
                    } else {
                        submitBtn.innerHTML = '<i class="fas fa-plus" id="movieSubmitIcon"></i> <span id="movieSubmitBtnText">Add Movie</span>';
                    }
            }
        });

        // Load movies from API
        async function loadMovies() {
            try {
                const response = await fetch(`${API_URL}/movies`);
                const movies = await response.json();

                if (movies.length === 0) {
                    moviesContainer.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-film"></i>
                            <p>No movies found. Add your first movie above!</p>
                        </div>
                    `;
                    return;
                }

                moviesContainer.innerHTML = movies.map(movie => `
                    <div class="movie-card" data-title="${movie.title.toLowerCase()}">
                        ${movie.picture ? `<img src="${movie.picture}" alt="${movie.title}" class="movie-poster" onerror="this.src='https://via.placeholder.com/300x400'">` : ''}
                        <div class="movie-content">
                            <h3 class="movie-title">
                                <i class="fas fa-video"></i>
                                ${movie.title}
                            </h3>
                            <div class="movie-info">
                                <div class="movie-info-item">
                                    <i class="fas fa-language"></i>
                                    <span><strong>Language:</strong> ${movie.language}</span>
                                </div>
                                <div class="movie-info-item">
                                    <i class="fas fa-film"></i>
                                    <span><strong>Format:</strong> ${movie.format}</span>
                                </div>
                                <div class="movie-info-item">
                                    <i class="fas fa-rupee-sign"></i>
                                    <span><strong>Price:</strong> â‚¹${movie.price.toFixed(2)}</span>
                                </div>
                                <div class="movie-info-item">
                                    <i class="fas fa-calendar"></i>
                                    <span><strong>Date:</strong> ${movie.show_date || 'Not set'}</span>
                                </div>
                                <div class="movie-info-item">
                                    <i class="fas fa-clock"></i>
                                    <span><strong>Time:</strong> ${movie.show_time}</span>
                                </div>
                            </div>
                            <div class="movie-actions">
                                <button class="btn btn-primary btn-small" onclick="editMovie(${movie.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-danger btn-small" onclick="deleteMovie(${movie.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                <button class="btn btn-info btn-small" onclick="manageSeats(${movie.id})">
                                    <i class="fas fa-chair"></i> Manage Seats
                                </button>
                                
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                moviesContainer.innerHTML = `
                    <div class="alert alert-error" style="grid-column: 1 / -1;">
                        <i class="fas fa-exclamation-circle"></i>
                        Error loading movies: ${error.message}
                    </div>
                `;
            }
        }

        // Navigate to seat management for a movie
        function manageSeats(movieId) {
            window.location.href = `/admin-seats.html?movieId=${movieId}`;
        }

        function manageShows(movieId) {
            // Navigate to Shows section and preselect the movie
            window.__selectedShowsMovieId = movieId;
            showSection('shows');
            // After section loads, the initializer will pick up this selection
        }

        // Filter movies by search
        function filterMovies() {
            const searchTerm = document.getElementById('movieSearch').value.toLowerCase();
            const movieCards = document.querySelectorAll('.movie-card');
            
            movieCards.forEach(card => {
                const title = card.getAttribute('data-title');
                if (title.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

            // Reset movie form to add mode
            function resetMovieForm() {
                const form = document.getElementById('addMovieForm');
                form.reset();
                const idEl = document.getElementById('editMovieId'); if (idEl) idEl.value = '';
                const titleEl = document.getElementById('movieFormTitle'); if (titleEl) titleEl.innerHTML = '<i class="fas fa-plus-circle"></i> Add New Movie';
                const btnTextEl = document.getElementById('movieSubmitBtnText'); if (btnTextEl) btnTextEl.textContent = 'Add Movie';
                const iconEl = document.getElementById('movieSubmitIcon'); if (iconEl) iconEl.className = 'fas fa-plus';
                // Scroll to form
                form.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // Edit movie
            async function editMovie(movieId) {
                try {
                    console.debug('Edit movie clicked', movieId);
                    const response = await fetch(`${API_URL}/movies/${movieId}`);
                    const movie = await response.json();
                    if (!movie || movie.error) {
                        showAlert(movie?.error || 'Movie not found!', 'error');
                        return;
                    }

                    // Populate form with movie data
                    const setVal = (id, val)=>{ const el = document.getElementById(id); if (el) el.value = val; };
                    setVal('editMovieId', movie.id);
                    setVal('title', movie.title || '');
                    setVal('price', movie.price ?? '');
                    setVal('classicSeatPrice', (movie.classic_price ?? 381.36));
                    setVal('primeSeatPrice', (movie.prime_price ?? 481.36));
                    setVal('date', movie.show_date || '');
                    setVal('showtime', movie.show_time || '');
                    setVal('description', movie.description || '');
                    setVal('picture', movie.picture || '');

                    // Set multi-select values for language
                    const languageSelect = document.getElementById('language');
                    const languages = String(movie.language || '').split(',').map(l => l.trim()).filter(Boolean);
                    Array.from(languageSelect.options).forEach(option => {
                        option.selected = languages.includes(option.value);
                    });

                    // Set multi-select values for format
                    const formatSelect = document.getElementById('format');
                    const formats = String(movie.format || '').split(',').map(f => f.trim()).filter(Boolean);
                    Array.from(formatSelect.options).forEach(option => {
                        option.selected = formats.includes(option.value);
                    });

                    // Update form UI to edit mode
                    const titleEl2 = document.getElementById('movieFormTitle'); if (titleEl2) titleEl2.innerHTML = '<i class="fas fa-edit"></i> Edit Movie';
                    const btnTextEl2 = document.getElementById('movieSubmitBtnText'); if (btnTextEl2) btnTextEl2.textContent = 'Update Movie';
                    const iconEl2 = document.getElementById('movieSubmitIcon'); if (iconEl2) iconEl2.className = 'fas fa-save';

                    // Scroll to form
                    document.getElementById('addMovieForm').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                    showAlert('Movie loaded for editing', 'success');
                } catch (error) {
                    console.error('Edit movie failed', error);
                    showAlert('Error loading movie: ' + error.message, 'error');
                }
            }

        // Delete movie
        async function deleteMovie(movieId) {
            if (!confirm('Are you sure you want to delete this movie?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/movies/${movieId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('Movie deleted successfully!', 'success');
                    loadMovies(); // Reload movies list
                    loadDashboardStats(); // Update stats
                } else {
                    showAlert(`Error: ${result.error}`, 'error');
                }
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            }
        }

        // Load bookings
        async function loadBookings() {
            const bookingsContainer = document.getElementById('bookingsContainer');
            try {
                const response = await fetch(`${API_URL}/bookings`);
                const bookings = await response.json();

                if (bookings.length === 0) {
                    bookingsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-ticket-alt"></i>
                            <p>No bookings found yet.</p>
                        </div>
                    `;
                    return;
                }

                // Normalize price numbers to avoid toFixed errors
                const normalized = bookings.map(b => ({
                    ...b,
                    _total_price_num: Number.parseFloat(b.total_price)
                }));

                bookingsContainer.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Booking ID</th>
                                <th>Username</th>
                                <th>Movie ID</th>
                                <th>Seats</th>
                                <th>Total Price</th>
                                <th>Booking Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${normalized.map(booking => `
                                <tr>
                                    <td><strong>#${booking.id}</strong></td>
                                    <td>${booking.username}</td>
                                    <td>${booking.movie_id}</td>
                                    <td>${booking.seats}</td>
                                    <td><strong>${Number.isNaN(booking._total_price_num) ? '-' : 'â‚¹' + booking._total_price_num.toFixed(2)}</strong></td>
                                    <td>${new Date(booking.booking_time).toLocaleString()}</td>
                                    <td><button class="btn btn-secondary btn-small" onclick="resetBooking(${booking.id})"><i class='fas fa-undo'></i> Reset</button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                bookingsContainer.innerHTML = `
                    <div class="alert alert-error">
                        <i class="fas fa-exclamation-circle"></i>
                        Error loading bookings: ${error.message}
                    </div>
                `;
            }
        }

        async function resetBooking(id) {
            if (!confirm('Reset this booking and free seats?')) return;
            try {
                const res = await fetch(`${API_URL}/bookings/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                showAlert('Booking reset successfully', 'success');
                loadBookings();
                loadDashboardStats();
            } catch (e) {
                showAlert(`Error: ${e.message}`, 'error');
            }
        }

        // Users Management
        async function loadUsers() {
            const container = document.getElementById('usersContainer');
            try {
                const res = await fetch(`${API_URL}/users`);
                const users = await res.json();
                if (!Array.isArray(users) || users.length === 0) {
                    container.innerHTML = `<div class="empty-state"><i class='fas fa-users'></i><p>No users yet. Click Sync to import from bookings.</p></div>`;
                    return;
                }
                container.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th><th>Username</th><th>Bookings</th><th>Status</th><th>Last Active</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(u => `
                                <tr>
                                    <td>#${u.id}</td>
                                    <td>${u.username}</td>
                                    <td>${u.booking_count || 0}</td>
                                    <td>${u.is_blocked ? '<span class="badge badge-danger">Blocked</span>' : '<span class="badge badge-success">Active</span>'}</td>
                                    <td>${u.last_active ? new Date(u.last_active).toLocaleString() : '-'}</td>
                                    <td style="display:flex; gap:.5rem;">
                                        <button class="btn btn-secondary btn-small" onclick="viewUserBookings(${u.id})"><i class='fas fa-eye'></i> View</button>
                                        <button class="btn ${u.is_blocked ? 'btn-success' : 'btn-danger'} btn-small" onclick="toggleBlock(${u.id}, ${u.is_blocked ? 'false' : 'true'})">
                                            <i class='fas ${u.is_blocked ? 'fa-unlock' : 'fa-ban'}'></i> ${u.is_blocked ? 'Unblock' : 'Block'}
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;
            } catch (e) {
                container.innerHTML = `<div class='alert alert-error'><i class='fas fa-exclamation-circle'></i> ${e.message}</div>`;
            }
        }

        async function toggleBlock(id, state) {
            try {
                const res = await fetch(`${API_URL}/users/${id}/block`, { method:'PATCH', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ is_blocked: state }) });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                showAlert('User status updated', 'success');
                loadUsers();
            } catch (e) {
                showAlert(`Error: ${e.message}`, 'error');
            }
        }

        async function viewUserBookings(id) {
            try {
                const res = await fetch(`${API_URL}/users/${id}/bookings`);
                const bookings = await res.json();
                if (!Array.isArray(bookings)) throw new Error('Failed to load bookings');
                const rows = bookings.map(b => `#${b.id} â€¢ ${b.movie_title} â€¢ ${b.seats} â€¢ â‚¹${parseFloat(b.total_price).toFixed(2)} â€¢ ${new Date(b.booking_time).toLocaleString()}`).join('\n');
                alert(rows || 'No bookings');
            } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
        }

        async function syncUsers() {
            try {
                const res = await fetch(`${API_URL}/users/sync`, { method: 'POST' });
                const data = await res.json();
                if (!res.ok) throw new Error(data.error || 'Failed');
                showAlert('Users synced from bookings', 'success');
                loadUsers();
                populateNotifyUsers();
            } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
        }

        // Notifications
        async function populateNotifyUsers() {
            try {
                const res = await fetch(`${API_URL}/users`);
                const users = await res.json();
                const sel = document.getElementById('notifyUsers');
                if (!sel) return;
                const current = sel.value;
                sel.innerHTML = '<option value="all">All users</option>' + (Array.isArray(users) ? users.map(u => `<option value="${u.username}">${u.username}</option>`).join('') : '');
                if (current) sel.value = current;
            } catch {}
        }

        const notifyForm = document.getElementById('notifyForm');
        if (notifyForm) {
            notifyForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const message = document.getElementById('notifyMessage').value.trim();
                const sel = document.getElementById('notifyUsers');
                const value = sel.value;
                const payload = value === 'all' ? { message } : { message, usernames: [value] };
                try {
                    const res = await fetch(`${API_URL}/notifications`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
                    const data = await res.json();
                    if (!res.ok) throw new Error(data.error || 'Failed');
                    showAlert('Notification queued', 'success');
                    document.getElementById('notifyMessage').value = '';
                    loadNotifications();
                } catch (e) { showAlert(`Error: ${e.message}`, 'error'); }
            });
        }

        async function loadNotifications() {
            const container = document.getElementById('notificationsContainer');
            try {
                const res = await fetch(`${API_URL}/notifications`);
                const list = await res.json();
                if (!Array.isArray(list) || list.length === 0) {
                    container.innerHTML = `<div class='empty-state'><i class='fas fa-bell'></i><p>No notifications yet.</p></div>`;
                    return;
                }
                container.innerHTML = `
                    <table>
                        <thead><tr><th>ID</th><th>Recipient</th><th>Message</th><th>Time</th></tr></thead>
                        <tbody>
                            ${list.map(n => `
                                <tr>
                                    <td>#${n.id}</td>
                                    <td>${n.username || 'All'}</td>
                                    <td>${n.message}</td>
                                    <td>${new Date(n.created_at).toLocaleString()}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;
            } catch (e) {
                container.innerHTML = `<div class='alert alert-error'><i class='fas fa-exclamation-circle'></i> ${e.message}</div>`;
            }
        }

        // Show alert message
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            
            const icon = type === 'success' 
                ? '<i class="fas fa-check-circle"></i>' 
                : '<i class="fas fa-exclamation-circle"></i>';
            
            alertDiv.innerHTML = `${icon} ${message}`;
            
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 300);
            }, 5000);
        }

        // Price Management (Deprecated) - guard against missing elements
        // Kept for backward compatibility; UI removed.
        const priceForm = document.getElementById('priceForm');
        function loadCurrentPrices() {}
        if (priceForm) {
            function loadCurrentPrices() {
                const classicPrice = localStorage.getItem('classicPrice') || '381.36';
                const primePrice = localStorage.getItem('primePrice') || '481.36';
                const classicEl = document.getElementById('classicPrice');
                const primeEl = document.getElementById('primePrice');
                if (classicEl) classicEl.value = classicPrice;
                if (primeEl) primeEl.value = primePrice;
            }
            priceForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const classicEl = document.getElementById('classicPrice');
                const primeEl = document.getElementById('primePrice');
                if (!classicEl || !primeEl) return;
                const classicPrice = parseFloat(classicEl.value);
                const primePrice = parseFloat(primeEl.value);
                if (isNaN(classicPrice) || isNaN(primePrice)) {
                    showAlert('Please enter valid prices', 'error');
                    return;
                }
                if (classicPrice < 0 || primePrice < 0) {
                    showAlert('Prices cannot be negative', 'error');
                    return;
                }
                try {
                    localStorage.setItem('classicPrice', classicPrice.toString());
                    localStorage.setItem('primePrice', primePrice.toString());
                    showAlert('Seat prices updated successfully!', 'success');
                } catch (error) {
                    showAlert(`Error: ${error.message}`, 'error');
                }
            });
        }
    </script>
</body>
</html>
